{% doc %}
  @prompt
    an email signup where the input is on top and the button is underneath. the button split between the button and an arrow to the right., I would like to add space between the button and the arrow, heading size should go up to 64 for desktop, I should be able to choose the max-width of the buttons, I would like to be able to choose the width of the buttons
    
    Hovering over the button or the arrow should create the hover state for both elements, there should be corner radius on all sides of both the button and the arrow
{% enddoc %}

{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-email-signup-{{ ai_gen_id }} {
    max-width: 600px;
    margin: 0 auto;
    padding: 40px 20px;
    text-align: center;
  }

  .ai-email-signup-heading-{{ ai_gen_id }} {
    font-size: {{ block.settings.heading_size }}px;
    color: {{ block.settings.heading_color }};
    margin: 0 0 24px 0;
  }

  .ai-email-signup-subtext-{{ ai_gen_id }} {
    font-size: 16px;
    color: {{ block.settings.text_color }};
    margin: 0 0 32px 0;
    line-height: 1.5;
  }

  .ai-email-signup-form-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    gap: 16px;
    align-items: center;
  }

  .ai-email-signup-input-{{ ai_gen_id }} {
    width: 100%;
    max-width: {{ block.settings.input_max_width }}px;
    /* padding: 16px 20px; */
    border: 2px solid {{ block.settings.input_border_color }};
    border-radius: {{ block.settings.input_border_radius }}px;
    font-size: 16px;
    background-color: {{ block.settings.input_background_color }};
    color: {{ block.settings.input_text_color }};
    margin-bottom:.5rem;
    height: 64px;
  }
  .ai-email-signup-input-{{ ai_gen_id }}:focus {
    outline: none;
    border-color: {{ block.settings.input_focus_color }};
  }

  .ai-email-signup-button-wrapper-{{ ai_gen_id }} {
    display: flex;
    width: {{ block.settings.button_width }}px;
    max-width: {{ block.settings.button_max_width }}px;
    gap: {{ block.settings.button_gap }}px;
  }

  .ai-email-signup-button-{{ ai_gen_id }},
  .ai-email-signup-arrow-{{ ai_gen_id }} {
    background-color: {{ block.settings.button_background_color }};
    color: {{ block.settings.button_text_color }};
    border: none;
    border-radius: {{ block.settings.button_border_radius }}px;
    cursor: pointer;
    transition: background-color .3s ease, color .3s ease;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 64px; /* consistent height */
  }

  .ai-email-signup-button-{{ ai_gen_id }} {
    flex: 1;
    padding: 0 24px; /* horizontal padding only */
    font-size: 22px;
    font-family: "Trim";
    font-weight: 500;
    position: relative;
  }

  .ai-email-signup-arrow-{{ ai_gen_id }} {
    width: 60px;
    position: relative;
  }

  .ai-email-signup-button-wrapper-{{ ai_gen_id }}:hover .ai-email-signup-button-{{ ai_gen_id }},
  .ai-email-signup-button-wrapper-{{ ai_gen_id }}:hover .ai-email-signup-arrow-{{ ai_gen_id }} {
    background-color: {{ block.settings.button_hover_background_color }};
    color: {{ block.settings.button_hover_text_color }};
  }

  /* -------- SLIDE ANIMATION (absolute layers, centered) -------- */
  .slide-wrapper {
    position: relative;
    display: block;
    width: 100%;
    height: 100%;     /* match the 52px parent */
    overflow: hidden; /* clip offscreen copy */
  }

  .slide-text,
  .slide-arrow {
    position: absolute;
    inset: 0;                /* top:0 right:0 bottom:0 left:0 */
    display: flex;
    align-items: center;     /* vertical centering */
    justify-content: center; /* horizontal centering */
    transition: transform .32s cubic-bezier(.22,.61,.36,1);
    will-change: transform;
    backface-visibility: hidden;
    transform: translateY(0);
  }

  /* second copy starts just below the container height */
  .slide-text:last-child,
  .slide-arrow:last-child {
    transform: translateY(100%);
  }

  /* on hover they swap */
  .ai-email-signup-button-wrapper-{{ ai_gen_id }}:hover .slide-text:first-child,
  .ai-email-signup-button-wrapper-{{ ai_gen_id }}:hover .slide-arrow:first-child {
    transform: translateY(-100%);
  }
  .ai-email-signup-button-wrapper-{{ ai_gen_id }}:hover .slide-text:last-child,
  .ai-email-signup-button-wrapper-{{ ai_gen_id }}:hover .slide-arrow:last-child {
    transform: translateY(0);
  }

  .ai-email-signup-arrow-icon-{{ ai_gen_id }} {
    width: 20px;
    height: 20px;
    display: block;
  }

  .ai-email-signup-success-{{ ai_gen_id }} {
    color: {{ block.settings.success_color }};
    margin-top: 16px;
    font-size: 14px;
  }
  .ai-email-signup-error-{{ ai_gen_id }} {
    color: {{ block.settings.error_color }};
    margin-top: 16px;
    font-size: 14px;
  }

  @media screen and (max-width: 749px) {
    .ai-email-signup-heading-{{ ai_gen_id }} {
      font-size: {{ block.settings.heading_size | times: 0.8 }}px;
    }
    .ai-email-signup-button-wrapper-{{ ai_gen_id }} {
      width: 100%;
      max-width: {{ block.settings.input_max_width }}px;
    }
  }

  /* Placeholder: black at 30% */
.ai-email-signup-input-{{ ai_gen_id }}::placeholder {
  color: rgba(0, 0, 0, 0.3); /* #0000004D */
}
.ai-email-signup-input-{{ ai_gen_id }}::-webkit-input-placeholder {
  color: rgba(0, 0, 0, 0.3);
}
.ai-email-signup-input-{{ ai_gen_id }}::-moz-placeholder {
  color: rgba(0, 0, 0, 0.3);
  opacity: 1; /* prevent extra fading in Firefox */
}

{% endstyle %}

<div class="ai-email-signup-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  {% form 'customer' %}
    <div class="ai-email-signup-form-{{ ai_gen_id }}">
      {% if form.posted_successfully? %}
      {%- comment -%} SUCCESS STATE — two-line heading + custom subtext {%- endcomment -%}
      <h2 class="ai-email-signup-heading-{{ ai_gen_id }}">
        <span class="success-line1-{{ ai_gen_id }}">{{ block.settings.success_heading_line1 | default: "Congrats," }}</span><br>
        <span class="success-line2-{{ ai_gen_id }}">{{ block.settings.success_heading_line2 | default: "you’re in!" }}</span>
      </h2>
      <div class="ai-email-signup-subtext-{{ ai_gen_id }}">
        {{ block.settings.success_subtext | default: "You’ll hear from us soon with early access updates, launch news, and content we only share with our list. In the meantime, follow us on socials to see the training, testing, and behind-the-scenes work that goes into every FORU protocol." }}
      </div>

      <script>
        (function () {
          // 1) Remove any hash (#something) that makes the browser scroll to the message
          if (location.hash) {
            history.replaceState(null, '', location.pathname + location.search);
          }
    
          // 2) Defuse theme auto-focus on the message by moving focus to the top container
          var topEl = document.getElementById('MainContent') || document.documentElement;
          if (topEl && topEl.focus) {
            topEl.setAttribute('tabindex', '-1');
            topEl.focus({ preventScroll: true });
            topEl.removeAttribute('tabindex');
          }
    
          // 3) Explicitly scroll to top (in case any script tried to scroll)
          window.scrollTo({ top: 0, left: 0, behavior: 'auto' });
        })();
      </script>

      {% else %}
        {%- comment -%} NORMAL STATE {%- endcomment -%}
        {% if block.settings.heading != blank %}
          <h2 class="ai-email-signup-heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
        {% endif %}

        {% if block.settings.subtext != blank %}
          <div class="ai-email-signup-subtext-{{ ai_gen_id }}">{{ block.settings.subtext }}</div>
        {% endif %}

        <input type="hidden" name="contact[tags]" value="newsletter, Founding Member">
        <input type="hidden" name="customer[accepts_marketing]" value="true">

        <input
          type="email"
          name="contact[email]"
          class="ai-email-signup-input-{{ ai_gen_id }}"
          value="{{ form.email }}"
          aria-required="true"
          autocorrect="off" autocapitalize="off" autocomplete="email"
          {% if form.errors %} aria-invalid="true" aria-describedby="ai-email-signup-error-{{ ai_gen_id }}"{% endif %}
          placeholder="{{ block.settings.email_placeholder }}"
          required
        >

        <div class="ai-email-signup-button-wrapper-{{ ai_gen_id }}">
          <button type="submit" class="ai-email-signup-button-{{ ai_gen_id }}">
            <span class="slide-wrapper">
              <span class="slide-text">{{ block.settings.button_text }}</span>
              <span class="slide-text">{{ block.settings.button_text }}</span>
            </span>
          </button>

          <button type="submit" class="ai-email-signup-arrow-{{ ai_gen_id }}" aria-label="Submit email">
            <span class="slide-wrapper">
              <span class="slide-arrow">
                <svg class="ai-email-signup-arrow-icon-{{ ai_gen_id }}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
              </span>
              <span class="slide-arrow">
                <svg class="ai-email-signup-arrow-icon-{{ ai_gen_id }}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
              </span>
            </span>
          </button>
        </div>

        {% if form.errors %}
          <div id="ai-email-signup-error-{{ ai_gen_id }}" class="ai-email-signup-error-{{ ai_gen_id }}">
            {{ form.errors.messages.email | default: "Please enter a valid email." }}
          </div>
        {% endif %}
      {% endif %}
    </div>
  {% endform %}
</div>



{% schema %}
{
  "name": "Email signup",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Stay in the loop"
    },
    {
      "type": "textarea",
      "id": "subtext",
      "label": "Subtext",
      "default": "Subscribe to our newsletter for the latest updates and exclusive offers."
    },
    {
      "type": "text",
      "id": "email_placeholder",
      "label": "Email placeholder",
      "default": "Enter your email address"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Subscribe"
    },
    {
      "type": "text",
      "id": "success_message",
      "label": "Success message",
      "default": "Thanks for subscribing!"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 16,
      "max": 64,
      "step": 2,
      "unit": "px",
      "label": "Heading size",
      "default": 32
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "input_max_width",
      "min": 200,
      "max": 600,
      "step": 20,
      "unit": "px",
      "label": "Input max width",
      "default": 400
    },
    {
      "type": "range",
      "id": "button_width",
      "min": 200,
      "max": 500,
      "step": 20,
      "unit": "px",
      "label": "Button width",
      "default": 300
    },
    {
      "type": "range",
      "id": "button_max_width",
      "min": 200,
      "max": 600,
      "step": 20,
      "unit": "px",
      "label": "Button max width",
      "default": 400
    },
    {
      "type": "range",
      "id": "button_gap",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Gap between button and arrow",
      "default": 4
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "input_background_color",
      "label": "Input background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "input_text_color",
      "label": "Input text color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "input_border_color",
      "label": "Input border color",
      "default": "#e6e6e6"
    },
    {
      "type": "color",
      "id": "input_focus_color",
      "label": "Input focus border color",
      "default": "#000f9f"
    },
    {
      "type": "color",
      "id": "button_background_color",
      "label": "Button background",
      "default": "#000f9f"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_hover_background_color",
      "label": "Button hover background",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_hover_text_color",
      "label": "Button hover text color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "success_color",
      "label": "Success message color",
      "default": "#008060"
    },
    {
      "type": "color",
      "id": "error_color",
      "label": "Error message color",
      "default": "#d82c0d"
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "range",
      "id": "input_border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Input border radius",
      "default": 8
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Button border radius",
      "default": 8
    }
  ],
  "presets": [
    {
      "name": "Email signup"
    }
  ]
}
{% endschema %}